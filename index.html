<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Fairuz Shop ‚Äî Marketplace (Tokopedia-inspired)</title>
<meta name="description" content="Fairuz Shop ‚Äî demo marketplace with categories, banner slider, product preview gallery, filters and cart (localStorage). Images from Unsplash by category."/>
<style>
  :root{
    --bg:#f3f6f8; --card:#fff; --muted:#6b7280;
    --primary:#06b981; --accent:#049d64; --glass:rgba(2,6,23,0.04);
    --maxw:1200px; font-family:Inter,system-ui,Roboto,Arial,sans-serif;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:var(--bg);color:#0f172a}
  a{color:var(--primary)}
  img{display:block;max-width:100%}

  /* TOPBAR */
  .topbar{position:sticky;top:0;z-index:90;background:white;border-bottom:1px solid rgba(0,0,0,0.06)}
  .topbar .inner{max-width:var(--maxw);margin:0 auto;display:flex;gap:12px;align-items:center;padding:12px}
  .brand{display:flex;align-items:center;gap:10px}
  .brand .mark{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--primary),var(--accent));display:grid;place-items:center;color:white;font-weight:800;font-size:20px}
  .brand h1{font-size:18px;margin:0}
  .searchbar{flex:1;display:flex;gap:8px;align-items:center}
  .searchbar input{flex:1;padding:10px 12px;border-radius:10px;border:1px solid rgba(0,0,0,0.08);outline:none}
  .searchbar button{padding:10px 14px;border-radius:10px;border:none;background:var(--primary);color:white;cursor:pointer;font-weight:700}
  .icons{display:flex;gap:10px;align-items:center}
  .icon-btn{background:transparent;border:0;padding:8px 10px;border-radius:8px;cursor:pointer;color:var(--muted)}
  .cart-badge{background:var(--primary);color:white;padding:4px 8px;border-radius:999px;font-weight:700;font-size:13px}

  /* CATEGORIES BAR */
  .catbar{background:white;border-bottom:1px solid rgba(0,0,0,0.04);padding:8px 0}
  .catbar .inner{max-width:var(--maxw);margin:0 auto;padding:0 12px;display:flex;gap:8px;overflow:auto;align-items:center}
  .cat{flex:0 0 auto;padding:8px 12px;border-radius:999px;border:1px solid rgba(0,0,0,0.04);background:var(--glass);cursor:pointer;color:#0b6b4a;font-weight:700;white-space:nowrap}
  .cat.active{background:linear-gradient(180deg,#eafaf0,#e2fae6);border-color:rgba(4,168,107,0.12)}

  /* HERO */
  .hero{max-width:var(--maxw);margin:18px auto;padding:0 12px;display:grid;grid-template-columns:1fr 300px;gap:16px;align-items:start}
  .slider{height:240px;border-radius:12px;overflow:hidden;position:relative}
  .slide{position:absolute;inset:0;background-size:cover;background-position:center;transition:opacity 450ms ease;opacity:0}
  .slide.show{opacity:1}
  .promo-cards{display:flex;flex-direction:column;gap:12px}
  .promo{background:linear-gradient(180deg,#fff,#f6fffb);padding:14px;border-radius:10px;border:1px solid rgba(0,0,0,0.04)}
  .promo h3{margin:0;color:var(--primary)}

  /* CONTROLS */
  .controls{max-width:var(--maxw);margin:12px auto;padding:0 12px;display:flex;justify-content:space-between;gap:12px;align-items:center}
  .filters{display:flex;gap:8px;align-items:center}
  .filters select,.filters input{padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.06)}
  .sort{display:flex;gap:8px;align-items:center}

  /* LAYOUT */
  .layout{max-width:var(--maxw);margin:0 auto;padding:12px;display:grid;grid-template-columns:260px 1fr;gap:18px}
  .sidebar{background:var(--card);border-radius:10px;padding:12px;border:1px solid rgba(0,0,0,0.04);height:calc(100vh - 340px);overflow:auto}
  .sidebar h3{margin-top:0}
  .category-list{display:flex;flex-direction:column;gap:6px}
  .category-list button{background:transparent;border:0;padding:8px;border-radius:8px;text-align:left;cursor:pointer}
  .category-list button:hover{background:var(--glass)}

  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:14px}
  .card{background:var(--card);border-radius:12px;padding:12px;border:1px solid rgba(0,0,0,0.04);display:flex;flex-direction:column;gap:8px;cursor:pointer;transition:transform .12s,box-shadow .12s}
  .card:hover{transform:translateY(-6px);box-shadow:0 12px 28px rgba(2,6,23,0.06)}
  .media{height:160px;border-radius:10px;overflow:hidden;background:#efefef;display:grid;place-items:center}
  .media img{width:100%;height:100%;object-fit:cover}
  .title{font-weight:700;font-size:14px;min-height:44px}
  .price{color:var(--primary);font-weight:800}
  .shop{font-size:12px;color:var(--muted)}

  /* CART DRAWER */
  .cart-drawer{position:fixed;right:12px;top:84px;width:380px;max-width:92vw;background:var(--card);border-radius:12px;padding:12px;border:1px solid rgba(0,0,0,0.06);box-shadow:0 18px 48px rgba(2,6,23,0.08);z-index:120;display:none}
  .cart-drawer.open{display:block}
  .cart-item{display:flex;gap:8px;align-items:center;padding:10px;border-bottom:1px dashed rgba(0,0,0,0.04)}
  .cart-item img{width:64px;height:64px;object-fit:cover;border-radius:8px}
  .cart-footer{display:flex;justify-content:space-between;align-items:center;margin-top:12px}

  /* MODAL */
  .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(2,6,23,0.5);z-index:200;padding:20px}
  .modal.open{display:flex}
  .modal-card{width:min(1000px,98vw);background:white;border-radius:12px;overflow:hidden;display:grid;grid-template-columns:460px 1fr}
  .gallery{background:#fafafa;padding:12px;display:flex;flex-direction:column;gap:10px}
  .gallery-main{height:420px;border-radius:8px;overflow:hidden;display:grid;place-items:center;background:#111}
  .gallery-main img{max-width:100%;max-height:100%;object-fit:contain}
  .gallery-thumbs{display:flex;gap:8px;overflow:auto;padding-top:6px}
  .thumb{width:72px;height:72px;border-radius:6px;overflow:hidden;border:2px solid transparent;cursor:pointer;flex:0 0 auto}
  .thumb img{width:100%;height:100%;object-fit:cover}
  .thumb.active{border-color:var(--primary)}

  .detail{padding:18px;display:flex;flex-direction:column;gap:12px}
  .detail h2{margin:0}
  .rating{display:flex;gap:8px;align-items:center;color:#f59e0b;font-weight:700}
  .detail .price{font-size:20px}
  .qty{display:flex;gap:8px;align-items:center}
  .qty button{padding:6px 10px;border-radius:8px;border:1px solid rgba(0,0,0,0.06);background:var(--glass);cursor:pointer}
  .actions{display:flex;gap:10px}
  .btn-primary{background:var(--primary);color:white;padding:10px 12px;border-radius:8px;border:none;cursor:pointer;font-weight:700}
  .btn-ghost{background:transparent;border:1px solid rgba(0,0,0,0.08);padding:10px 12px;border-radius:8px;cursor:pointer}

  /* responsive */
  @media(max-width:1000px){
    .hero{grid-template-columns:1fr}
    .modal-card{grid-template-columns:1fr}
    .gallery-main{height:320px}
    .sidebar{display:none}
  }
  @media(max-width:700px){
    .media{height:120px}
    .gallery-main{height:260px}
    .topbar .inner{padding:8px}
  }
</style>
</head>
<body>

  <!-- TOPBAR -->
  <header class="topbar" role="banner">
    <div class="inner">
      <div class="brand" aria-label="Fairuz Shop">
        <div class="mark">F</div>
        <div>
          <h1>Fairuz Shop</h1>
          <div style="font-size:12px;color:var(--muted)">Marketplace Prototype</div>
        </div>
      </div>

      <div class="searchbar" role="search">
        <input id="searchInput" placeholder="Cari produk, brand, atau kategori..." aria-label="Cari produk">
        <button id="btnSearch">Cari</button>
      </div>

      <div class="icons" aria-hidden="false">
        <button class="icon-btn" id="btnProfile" title="Akun">üë§</button>
        <button class="icon-btn" id="btnWishlist" title="Wishlist">‚ù§</button>
        <button class="icon-btn" id="btnCartToggle" aria-haspopup="true" aria-expanded="false" title="Keranjang">üõí <span class="cart-badge" id="cartCount">0</span></button>
      </div>
    </div>
  </header>

  <!-- CATEGORY BAR -->
  <div class="catbar" role="navigation" aria-label="Kategori">
    <div class="inner" id="catBar"></div>
  </div>

  <!-- HERO -->
  <section class="hero" aria-label="Promo">
    <div class="slider" id="slider"></div>
    <aside class="promo-cards" aria-hidden="true">
      <div class="promo">
        <h3>Flash Sale Hari Ini</h3>
        <p>Diskon hingga 70% untuk produk terpilih.</p>
      </div>
      <div class="promo">
        <h3>Gratis Ongkir</h3>
        <p>Untuk pembelian di atas Rp 200.000</p>
      </div>
    </aside>
  </section>

  <!-- CONTROLS -->
  <div class="controls" role="region" aria-label="Filter dan sorting">
    <div class="filters">
      <select id="filterCategory"><option value="all">Semua Kategori</option></select>
      <input id="minPrice" type="number" placeholder="Min (Rp)">
      <input id="maxPrice" type="number" placeholder="Max (Rp)">
      <button id="applyFilter" class="btn-ghost">Terapkan</button>
      <button id="resetFilter" class="btn-ghost">Reset</button>
    </div>
    <div class="sort">Urutkan: <select id="sortSelect"><option value="relevance">Relevansi</option><option value="price-asc">Harga: Rendah ke Tinggi</option><option value="price-desc">Harga: Tinggi ke Rendah</option></select></div>
  </div>

  <!-- LAYOUT -->
  <div class="layout" role="main">
    <aside class="sidebar" aria-label="Sidebar kategori">
      <h3>Kategori</h3>
      <div class="category-list" id="sidebarCats"></div>
      <hr />
      <h4>Filter Cepat</h4>
      <button onclick="quickFilter('Elektronik')">Elektronik</button>
      <button onclick="quickFilter('Fashion')">Fashion</button>
      <button onclick="quickFilter('Rumah Tangga')">Rumah Tangga</button>
    </aside>

    <section class="main-grid">
      <div class="grid" id="productGrid" tabindex="0"></div>
    </section>
  </div>

  <!-- CART DRAWER -->
  <aside class="cart-drawer" id="cartDrawer" role="region" aria-label="Keranjang belanja">
    <h3>Keranjang</h3>
    <div id="cartList"></div>
    <div class="cart-footer">
      <div><strong>Total:</strong> Rp <span id="cartTotal">0</span></div>
      <div><button id="checkoutBtn" class="btn-primary">Checkout</button></div>
    </div>
  </aside>

  <!-- PRODUCT PREVIEW MODAL -->
  <div class="modal" id="modal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-card" role="document">
      <div class="gallery">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div style="font-weight:700;color:var(--muted)">GALLERY</div>
          <div>
            <button id="prevImg" class="btn-ghost" aria-label="Sebelumnya">‚óÄ</button>
            <button id="nextImg" class="btn-ghost" aria-label="Selanjutnya">‚ñ∂</button>
          </div>
        </div>
        <div class="gallery-main" id="galleryMain"></div>
        <div class="gallery-thumbs" id="galleryThumbs" role="tablist"></div>
      </div>

      <div class="detail">
        <div style="display:flex;justify-content:space-between;align-items:flex-start">
          <div>
            <h2 id="pTitle">Product Title</h2>
            <div class="shop" id="pShop">Fairuz Official Store</div>
          </div>
          <button id="closeModal" class="btn-ghost" aria-label="Tutup preview">‚úï</button>
        </div>

        <div class="rating" id="pRating">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ <span style="color:var(--muted);font-weight:500;margin-left:8px">4.8 (120)</span></div>
        <div class="price" id="pPrice">Rp 0</div>
        <div id="pDesc" style="color:var(--muted);line-height:1.4"></div>

        <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap">
          <div>
            <label><strong>Warna</strong></label>
            <select id="variantColor"></select>
          </div>
          <div>
            <label><strong>Ukuran</strong></label>
            <select id="variantSize"></select>
          </div>
          <div class="qty">
            <button id="qtyDec" aria-label="Kurangi">‚àí</button>
            <input id="qtyInput" type="number" value="1" min="1" style="width:60px;padding:6px;border-radius:8px;border:1px solid rgba(0,0,0,0.06);text-align:center"/>
            <button id="qtyInc" aria-label="Tambah">+</button>
          </div>

          <div style="margin-left:auto;display:flex;gap:8px">
            <button id="addCartBtn" class="btn-primary">Tambah ke Keranjang</button>
            <button id="buyBtn" class="btn-ghost">Beli Sekarang</button>
          </div>
        </div>

        <div style="margin-top:12px;color:var(--muted);font-size:13px">
          <strong>Detail Produk:</strong>
          <div id="pDetail" style="margin-top:6px"></div>
        </div>
      </div>
    </div>
  </div>

  <footer style="max-width:var(--maxw);margin:24px auto;padding:12px;text-align:center;background:#fff;border-top:1px solid #eee;">
    Website ini terinspirasi dari <a href="https://www.tokopedia.com" target="_blank" rel="noopener">Tokopedia</a>.
  </footer>

<script>
/* ===== DATA (products with category-specific Unsplash images) ===== */
const PRODUCTS = [
  { id:101, title:"Smartphone Nova X", price:2799000, category:"Elektronik",
    images:[
      "https://source.unsplash.com/800x800/?smartphone,phone&sig=101",
      "https://source.unsplash.com/800x800/?mobile,device&sig=102",
      "https://source.unsplash.com/800x800/?phone,camera&sig=103"
    ], rating:4.6, reviews:245, shop:"Nova Official", desc:"Ponsel canggih dengan kamera 48MP, RAM 8GB.", detail:"Layar 6.5\", 8GB RAM, 128GB storage, fast charging.", variants:{colors:["Hitam","Putih","Biru"], sizes:["64GB","128GB"]}, stock:25
  },
  { id:102, title:"Laptop UltraBook Pro", price:10999000, category:"Elektronik",
    images:["https://source.unsplash.com/800x800/?laptop,notebook&sig=104","https://source.unsplash.com/800x800/?notebook,computer&sig=105"],
    rating:4.7, reviews:98, shop:"Fairuz Tech", desc:"Laptop tipis untuk kerja & kreasi.", detail:"Intel i7, 16GB RAM, 512GB SSD.", variants:{colors:["Silver"],sizes:["16GB/512GB"]}, stock:8
  },
  { id:103, title:"Headphone ANC Wireless", price:899000, category:"Elektronik",
    images:["https://source.unsplash.com/800x800/?headphones,audio&sig=106","https://source.unsplash.com/800x800/?headphone,wireless&sig=107"],
    rating:4.4, reviews:512, shop:"SoundCo", desc:"Noise cancelling, audio jernih.", detail:"ANC, bluetooth 5.2, 30 jam playtime.", variants:{colors:["Hitam","Abu"],sizes:[]}, stock:40
  },
  { id:201, title:"Sneakers RunFast", price:459000, category:"Fashion",
    images:["https://source.unsplash.com/800x800/?sneakers,shoe&sig=201","https://source.unsplash.com/800x800/?running,shoe&sig=202"],
    rating:4.2, reviews:320, shop:"RunFast Store", desc:"Sepatu lari ringan.", detail:"Upper breathable, midsole cushioning.", variants:{colors:["Merah","Hitam","Putih"],sizes:["39","40","41","42","43"]}, stock:60
  },
  { id:202, title:"Jaket Denim Original", price:349000, category:"Fashion",
    images:["https://source.unsplash.com/800x800/?denim,jacket&sig=203","https://source.unsplash.com/800x800/?jeans,jacket&sig=204"],
    rating:4.5, reviews:180, shop:"DenimHouse", desc:"Jaket denim klasik.", detail:"100% cotton, multiple pockets.", variants:{colors:["Denim"],sizes:["S","M","L","XL"]}, stock:22
  },
  { id:203, title:"Tas Ransel Travel", price:299000, category:"Fashion",
    images:["https://source.unsplash.com/800x800/?backpack,bag&sig=205","https://source.unsplash.com/800x800/?travel,backpack&sig=206"],
    rating:4.3, reviews:210, shop:"BagPack", desc:"Ransel travel banyak kompartemen.", detail:"Capacity 25L, laptop sleeve.", variants:{colors:["Hitam","Hijau"],sizes:[]}, stock:30
  },
  { id:301, title:"Meja Belajar Minimalis", price:899000, category:"Rumah Tangga",
    images:["https://source.unsplash.com/800x800/?desk,table&sig=301","https://source.unsplash.com/800x800/?study,desk&sig=302"],
    rating:4.6, reviews:105, shop:"HomeFit", desc:"Meja belajar modern.", detail:"Material MDF, easy assembly.", variants:{colors:["Oak","White"],sizes:[]}, stock:15
  },
  { id:302, title:"Lampu Meja LED", price:129000, category:"Rumah Tangga",
    images:["https://source.unsplash.com/800x800/?lamp,desk&sig=303","https://source.unsplash.com/800x800/?lighting,desk&sig=304"],
    rating:4.1, reviews:58, shop:"BrightHome", desc:"Lampu meja LED dimmable.", detail:"Dimmable, USB powered.", variants:{colors:["White","Black"],sizes:[]}, stock:100
  },
  { id:303, title:"Set Panci Stainless", price:399000, category:"Rumah Tangga",
    images:["https://source.unsplash.com/800x800/?cookware,kitchen&sig=305","https://source.unsplash.com/800x800/?pan,kitchen&sig=306"],
    rating:4.4, reviews:143, shop:"KitchenPro", desc:"Panci berkualitas.", detail:"Stainless steel, oven safe.", variants:{colors:[],sizes:[]}, stock:18
  },
  { id:401, title:"Vitamin C 500mg", price:89000, category:"Kesehatan",
    images:["https://source.unsplash.com/800x800/?vitamin,health&sig=401","https://source.unsplash.com/800x800/?supplement,vitamin&sig=402"],
    rating:4.8, reviews:720, shop:"HealthPlus", desc:"Suplemen Vitamin C.", detail:"500mg per tablet, 60 tablets.", variants:{colors:[],sizes:[]}, stock:300
  },
  { id:402, title:"Paket Skincare Basic", price:249000, category:"Kesehatan",
    images:["https://source.unsplash.com/800x800/?skincare,beauty&sig=403","https://source.unsplash.com/800x800/?cosmetics,skincare&sig=404"],
    rating:4.2, reviews:420, shop:"GlowCare", desc:"Set perawatan kulit untuk pemula.", detail:"Cleanser, toner, moisturizer.", variants:{colors:[],sizes:[]}, stock:120
  },
  { id:501, title:"Sepeda Gunung 26\"", price:3499000, category:"Olahraga",
    images:["https://source.unsplash.com/800x800/?mountain,bike&sig=501","https://source.unsplash.com/800x800/?bicycle,mountain&sig=502"],
    rating:4.5, reviews:89, shop:"CycleWorld", desc:"Sepeda gunung rangka kuat.", detail:"Frame steel, 21-speed.", variants:{colors:[],sizes:[]}, stock:6
  },
  { id:502, title:"Matras Yoga", price:129000, category:"Olahraga",
    images:["https://source.unsplash.com/800x800/?yoga,mat&sig=503","https://source.unsplash.com/800x800/?fitness,yoga&sig=504"],
    rating:4.3, reviews:200, shop:"FlexFit", desc:"Matras anti slip nyaman.", detail:"Thickness 6mm, non-toxic.", variants:{colors:["Purple","Grey","Blue"],sizes:[]}, stock:120
  },
  { id:601, title:"Mainan Edukasi Anak", price:189000, category:"Anak & Bayi",
    images:["https://source.unsplash.com/800x800/?kids,toy&sig=601","https://source.unsplash.com/800x800/?children,toys&sig=602"],
    rating:4.7, reviews:150, shop:"KidsWorld", desc:"Mainan edukatif stimulasi anak.", detail:"Age 3+, colorful blocks.", variants:{colors:[],sizes:[]}, stock:80
  },
  { id:602, title:"Stroller Bayi Ringan", price:999000, category:"Anak & Bayi",
    images:["https://source.unsplash.com/800x800/?stroller,baby&sig=603","https://source.unsplash.com/800x800/?baby,pram&sig=604"],
    rating:4.1, reviews:48, shop:"BabyCare", desc:"Stroller ringan, mudah dilipat.", detail:"Compact fold, safety harness.", variants:{colors:[],sizes:[]}, stock:10
  },
  { id:701, title:"Coklat Premium 250g", price:68000, category:"Makanan & Minuman",
    images:["https://source.unsplash.com/800x800/?chocolate,candy&sig=701","https://source.unsplash.com/800x800/?chocolate,bar&sig=702"],
    rating:4.9, reviews:520, shop:"SweetBite", desc:"Coklat premium rasa kaya.", detail:"Dark chocolate, 70% cocoa.", variants:{colors:[],sizes:[]}, stock:220
  },
  { id:702, title:"Kopi Arabica 250g", price:85000, category:"Makanan & Minuman",
    images:["https://source.unsplash.com/800x800/?coffee,beans&sig=703","https://source.unsplash.com/800x800/?coffee,cup&sig=704"],
    rating:4.6, reviews:300, shop:"RoastHouse", desc:"Kopi Arabica single origin.", detail:"250g pack, medium roast.", variants:{colors:[],sizes:[]}, stock:140
  },
  { id:703, title:"Snack Gurih 200g", price:25000, category:"Makanan & Minuman",
    images:["https://source.unsplash.com/800x800/?snack,crisps&sig=705","https://source.unsplash.com/800x800/?chips,food&sig=706"],
    rating:4.4, reviews:180, shop:"SnackTime", desc:"Snack gurih renyah.", detail:"200g pack, best before 6 months.", variants:{colors:[],sizes:[]}, stock:340
  }
];

/* ===== STATE ===== */
const state = {
  products: PRODUCTS.slice(),
  activeCategory: 'all',
  search: '',
  minPrice: 0,
  maxPrice: Infinity,
  sort: 'relevance',
  cart: JSON.parse(localStorage.getItem('fairuz_cart_v1') || '[]'),
  preview: { product: null, idx: 0 }
};

/* ===== HELPERS ===== */
const el = id => document.getElementById(id);
const format = n => n.toLocaleString('id-ID');

/* ===== RENDER CATEGORIES & SLIDER ===== */
function renderCategories(){
  const cats = ['all', ...Array.from(new Set(PRODUCTS.map(p=>p.category)))];
  const catBar = document.getElementById('catBar');
  const select = document.getElementById('filterCategory');
  const sidebar = document.getElementById('sidebarCats');
  catBar.innerHTML = ''; select.innerHTML = '<option value="all">Semua Kategori</option>'; sidebar.innerHTML = '';
  cats.forEach(c=>{
    const label = c==='all' ? 'Semua' : c;
    const btn = document.createElement('button'); btn.className='cat'; btn.textContent = label;
    btn.onclick = ()=> { state.activeCategory = c; applyFilters(); highlightCats(); };
    catBar.appendChild(btn);
    if(c!=='all'){
      const opt = document.createElement('option'); opt.value = c; opt.textContent = c; select.appendChild(opt);
      const sb = document.createElement('button'); sb.textContent = c; sb.onclick = ()=>{ state.activeCategory = c; applyFilters(); highlightCats(); }; sidebar.appendChild(sb);
    }
  });
  highlightCats();
}
function highlightCats(){
  Array.from(document.querySelectorAll('.cat')).forEach(b=>{
    b.classList.toggle('active', b.textContent === (state.activeCategory==='all'?'Semua':state.activeCategory));
  });
}

/* slider */
const sliderImages = [
  "https://source.unsplash.com/1200x400/?shopping,online&sig=900",
  "https://source.unsplash.com/1200x400/?sale,discount&sig=901",
  "https://source.unsplash.com/1200x400/?market,store&sig=902"
];
function renderSlider(){
  const slider = document.getElementById('slider'); slider.innerHTML='';
  sliderImages.forEach((src,i)=>{
    const s = document.createElement('div'); s.className = 'slide' + (i===0 ? ' show' : ''); s.style.backgroundImage = `url(${src})`; slider.appendChild(s);
  });
  let idx = 0;
  setInterval(()=> {
    const slides = slider.querySelectorAll('.slide');
    slides.forEach((sl,si)=> sl.classList.toggle('show', si===((idx+1)%slides.length)));
    idx = (idx+1)%slides.length;
  }, 4500);
}

/* ===== RENDER GRID ===== */
function renderGrid(){
  const grid = document.getElementById('productGrid'); grid.innerHTML = '';
  let list = state.products.slice();

  // search
  if(state.search){ const q = state.search.toLowerCase(); list = list.filter(p=> (p.title+' '+p.desc+' '+p.detail+' '+p.shop).toLowerCase().includes(q)); }
  // category
  if(state.activeCategory !== 'all') list = list.filter(p=>p.category === state.activeCategory);
  // price
  list = list.filter(p=> p.price >= (state.minPrice || 0) && p.price <= (isFinite(state.maxPrice)?state.maxPrice:Infinity));
  // sort
  if(state.sort === 'price-asc') list.sort((a,b)=>a.price-b.price);
  else if(state.sort === 'price-desc') list.sort((a,b)=>b.price-a.price);
  else list.sort((a,b)=>b.rating - a.rating);

  for(const p of list){
    const card = document.createElement('article'); card.className='card'; card.tabIndex=0;
    card.innerHTML = `
      <div class="media"><img src="${p.images[0]}" alt="${p.title}"></div>
      <div class="title">${p.title}</div>
      <div class="shop">${p.shop} ‚Ä¢ ${p.category}</div>
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div class="price">Rp ${format(p.price)}</div>
        <div style="font-size:12px;color:var(--muted)">${p.rating} ‚òÖ</div>
      </div>
      <div style="display:flex;gap:8px;margin-top:10px">
        <button class="btn-primary add-btn" data-id="${p.id}">Tambah</button>
        <button class="btn-ghost preview-btn" data-id="${p.id}">Preview</button>
      </div>
    `;
    card.querySelector('.add-btn').addEventListener('click', (e)=>{ e.stopPropagation(); addToCartById(p.id); });
    card.querySelector('.preview-btn').addEventListener('click', (e)=>{ e.stopPropagation(); openPreview(p.id); });
    card.addEventListener('click', ()=> openPreview(p.id));
    grid.appendChild(card);
  }
}

/* ===== FILTERS / UI HOOKS ===== */
document.getElementById('searchInput').addEventListener('input', (e)=>{ state.search = e.target.value; applyFilters(); });
document.getElementById('applyFilter').addEventListener('click', ()=>{ state.minPrice = Number(document.getElementById('minPrice').value) || 0; const max = Number(document.getElementById('maxPrice').value); state.maxPrice = max>0?max:Infinity; applyFilters(); });
document.getElementById('resetFilter').addEventListener('click', ()=>{ document.getElementById('minPrice').value=''; document.getElementById('maxPrice').value=''; document.getElementById('filterCategory').value='all'; state.minPrice=0; state.maxPrice=Infinity; state.activeCategory='all'; applyFilters(); highlightCats(); });
document.getElementById('filterCategory').addEventListener('change', (e)=>{ state.activeCategory = e.target.value; applyFilters(); highlightCats(); });
document.getElementById('sortSelect').addEventListener('change', (e)=>{ state.sort = e.target.value; applyFilters(); });

function quickFilter(cat){ state.activeCategory = cat; applyFilters(); highlightCats(); }
function applyFilters(){ renderGrid(); }

/* ===== CART ===== */
function saveCart(){ localStorage.setItem('fairuz_cart_v1', JSON.stringify(state.cart)); }
function loadCart(){ state.cart = JSON.parse(localStorage.getItem('fairuz_cart_v1') || '[]'); }
function addToCartById(id, qty=1){
  const p = PRODUCTS.find(x=>x.id===id); if(!p) return;
  const existing = state.cart.find(ci=>ci.id===id);
  if(existing) existing.qty += qty; else state.cart.push({ id:p.id, title:p.title, price:p.price, img:p.images[0], qty });
  saveCart(); renderCart(); showCart();
}
function renderCart(){
  const list = document.getElementById('cartList'); list.innerHTML=''; let total=0;
  for(const it of state.cart){
    const row = document.createElement('div'); row.className='cart-item';
    row.innerHTML = `<img src="${it.img}" alt="${it.title}"><div style="flex:1"><div style="font-weight:700">${it.title}</div><div style="color:var(--muted)">Rp ${format(it.price)} x <input type="number" value="${it.qty}" min="1" data-id="${it.id}" style="width:60px;padding:4px;border-radius:6px;border:1px solid rgba(0,0,0,0.06)"></div></div><div><button class="btn-ghost remove" data-id="${it.id}">Hapus</button></div>`;
    list.appendChild(row);
    total += it.price * it.qty;
  }
  el('cartTotal').textContent = format(total);
  el('cartCount').textContent = state.cart.reduce((s,i)=>s+i.qty,0);
  // attach handlers
  Array.from(document.querySelectorAll('.cart-item input[type=number]')).forEach(inp=>{
    inp.addEventListener('change', e=>{ const id = Number(e.target.dataset.id); const val = Math.max(1, Number(e.target.value) || 1); const it = state.cart.find(c=>c.id===id); if(it){ it.qty = val; saveCart(); renderCart(); } });
  });
  Array.from(document.querySelectorAll('.cart-item .remove')).forEach(btn=>{
    btn.addEventListener('click', ()=>{ const id = Number(btn.dataset.id); state.cart = state.cart.filter(c=>c.id!==id); saveCart(); renderCart(); });
  });
}
document.getElementById('btnCartToggle').addEventListener('click', ()=> showCart());
function showCart(){ document.getElementById('cartDrawer').classList.add('open'); }
function hideCart(){ document.getElementById('cartDrawer').classList.remove('open'); }
document.getElementById('checkoutBtn').addEventListener('click', ()=>{
  if(state.cart.length===0){ alert('Keranjang kosong'); return; }
  const name = prompt('Masukkan nama penerima'); if(!name) return;
  const addr = prompt('Alamat pengiriman'); if(!addr) return;
  alert('Pesanan dibuat (mock). Terima kasih, ' + name);
  state.cart = []; saveCart(); renderCart(); hideCart();
});

/* ===== PREVIEW & GALLERY ===== */
const modal = el('modal'), galleryMain = el('galleryMain'), galleryThumbs = el('galleryThumbs');
function openPreview(id){
  const p = PRODUCTS.find(x=>x.id===id); if(!p) return;
  state.preview.product = p; state.preview.idx = 0; renderPreview();
  modal.classList.add('open'); modal.setAttribute('aria-hidden','false'); document.body.style.overflow='hidden';
}
function closePreview(){ modal.classList.remove('open'); modal.setAttribute('aria-hidden','true'); document.body.style.overflow=''; state.preview.product=null; state.preview.idx=0; }
el('closeModal').addEventListener('click', closePreview);
modal.addEventListener('click', (e)=>{ if(e.target === modal) closePreview(); });

function renderPreview(){
  const p = state.preview.product; if(!p) return;
  galleryMain.innerHTML = ''; const img = document.createElement('img'); img.src = p.images[state.preview.idx] + '&' + Date.now(); img.alt = p.title; galleryMain.appendChild(img);
  galleryThumbs.innerHTML = '';
  p.images.forEach((src,i)=>{
    const t = document.createElement('div'); t.className = 'thumb' + (i===state.preview.idx ? ' active' : '');
    t.innerHTML = `<img src="${src}">`;
    t.addEventListener('click', ()=>{ state.preview.idx = i; renderPreview(); });
    galleryThumbs.appendChild(t);
  });
  el('pTitle').textContent = p.title; el('pShop').textContent = p.shop + ' ‚Ä¢ ' + p.category;
  el('pRating').innerHTML = '‚òÖ'.repeat(Math.round(p.rating)) + '‚òÜ <span style="color:var(--muted);font-weight:500;margin-left:8px">' + p.rating.toFixed(1) + ' ('+p.reviews+')</span>';
  el('pPrice').textContent = 'Rp ' + format(p.price); el('pDesc').textContent = p.desc; el('pDetail').textContent = p.detail;
  // variants
  const colorSel = el('variantColor'), sizeSel = el('variantSize'); colorSel.innerHTML=''; sizeSel.innerHTML='';
  if(p.variants && p.variants.colors && p.variants.colors.length){ p.variants.colors.forEach(c=>{ const o=document.createElement('option'); o.value=o.textContent=c; colorSel.appendChild(o); }); }
  else { const o=document.createElement('option'); o.value='default'; o.textContent='Default'; colorSel.appendChild(o); }
  if(p.variants && p.variants.sizes && p.variants.sizes.length){ p.variants.sizes.forEach(s=>{ const o=document.createElement('option'); o.value=o.textContent=s; sizeSel.appendChild(o); }); }
  else { const o=document.createElement('option'); o.value='default'; o.textContent='Default'; sizeSel.appendChild(o); }
  el('qtyInput').value = 1;
}
el('prevImg').addEventListener('click', ()=>{ const p=state.preview.product; if(!p) return; state.preview.idx = (state.preview.idx -1 + p.images.length) % p.images.length; renderPreview(); });
el('nextImg').addEventListener('click', ()=>{ const p=state.preview.product; if(!p) return; state.preview.idx = (state.preview.idx +1) % p.images.length; renderPreview(); });

el('qtyInc').addEventListener('click', ()=> el('qtyInput').value = Number(el('qtyInput').value)+1 );
el('qtyDec').addEventListener('click', ()=> el('qtyInput').value = Math.max(1, Number(el('qtyInput').value)-1) );

el('addCartBtn').addEventListener('click', ()=>{
  const p = state.preview.product; if(!p) return;
  const q = Math.max(1, Number(el('qtyInput').value) || 1);
  const existing = state.cart.find(c=>c.id===p.id);
  if(existing) existing.qty += q; else state.cart.push({ id:p.id, title:p.title, price:p.price, img:p.images[0], qty:q });
  saveCart(); renderCart(); closePreview(); showCart();
});
el('buyBtn').addEventListener('click', ()=>{ const p = state.preview.product; if(!p) return; const q = Math.max(1, Number(el('qtyInput').value) || 1); alert('Beli cepat (mock): '+p.title+' x'+q); closePreview(); });

/* keyboard nav */
document.addEventListener('keydown', (e)=>{
  if(!state.preview.product) return;
  if(e.key === 'Escape') closePreview();
  if(e.key === 'ArrowRight'){ const p=state.preview.product; state.preview.idx = (state.preview.idx+1) % p.images.length; renderPreview(); }
  if(e.key === 'ArrowLeft'){ const p=state.preview.product; state.preview.idx = (state.preview.idx-1 + p.images.length) % p.images.length; renderPreview(); }
});

/* ===== INIT ===== */
function init(){
  renderCategories(); renderSlider(); renderGrid(); loadCart(); renderCart();
  // preload images (optional)
  PRODUCTS.forEach(p=>p.images.forEach(src=>{ const i=new Image(); i.src = src; }));
}
// load cart from localStorage
function loadCart(){ state.cart = JSON.parse(localStorage.getItem('fairuz_cart_v1') || '[]'); }
init();

/* small accessibility: Enter on focused card opens preview */
document.getElementById('productGrid').addEventListener('keydown', (e)=>{
  if(e.key === 'Enter' && document.activeElement && document.activeElement.classList.contains('card')){
    const cards = Array.from(document.querySelectorAll('.card'));
    const idx = cards.indexOf(document.activeElement);
    // derive visible products according to current filters
    let visible = state.products.slice();
    if(state.search){ const q = state.search.toLowerCase(); visible = visible.filter(p=> (p.title+' '+p.desc).toLowerCase().includes(q)); }
    if(state.activeCategory !== 'all') visible = visible.filter(p=>p.category === state.activeCategory);
    if(visible[idx]) openPreview(visible[idx].id);
  }
});

/* keep cart UI updated after load */
renderCart();
</script>
</body>
</html>
